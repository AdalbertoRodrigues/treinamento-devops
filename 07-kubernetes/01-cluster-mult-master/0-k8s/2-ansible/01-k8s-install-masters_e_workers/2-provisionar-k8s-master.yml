- hosts:
  - ec2-k8s-m2
  - ec2-k8s-m3
  become: yes
  tasks:
    - name: "Fazendo join kubernetes master"
      shell: kubeadm join k8s-haproxy:6443 --token audqg1.ailgfqc7sa9kvfv4 --discovery-token-ca-cert-hash sha256:f1e1f39c98c6b101867e588cf7f39aeb7f491c6b31ce53dca09bafbd9cfaa5f4 --control-plane --certificate-key 0fc8a4804333502dbcafa3bbc7d5b25214b9856651fb17e1666628ba84151bec

    - name: "Colocando no path da maquina o conf do kubernetes"
      shell: "mkdir -p $HOME/.kube && sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config && sudo chown $(id -u):$(id -g) $HOME/.kube/config && export KUBECONFIG=/etc/kubernetes/admin.conf"
#---
- hosts:
  - ec2-k8s-w1
  - ec2-k8s-w2
  - ec2-k8s-w3
  become: yes
  tasks:
    - name: "Fazendo join kubernetes worker"
      shell: kubeadm join k8s-haproxy:6443 --token audqg1.ailgfqc7sa9kvfv4 --discovery-token-ca-cert-hash sha256:f1e1f39c98c6b101867e588cf7f39aeb7f491c6b31ce53dca09bafbd9cfaa5f4

#---
- hosts:
  - ec2-k8s-m1
  become: yes
  tasks:
    - name: "Configura weavenet para reconhecer os n√≥s master e workers"
      shell: kubectl apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')"
  

# ansible-playbook -i hosts 2-provisionar-k8s-master.yml -u ubuntu --private-key ~/Desktop/devops/treinamentoItau

